<!-- 
'xs': '320px',
'sm': '640px',
'md': '768px',
'lg': '1024px',
'xl': '1280px',
'2xl': '1536px',
'desktop': '1200px',  
-->
<template>
    <div>
        <div class="container mx-auto py-28 px-4">
            <div class="flex flex-col gap-15">
                <!-- ë¬¸ì˜ ìƒë‹¨ -->
                <div
                    v-motion
                    :initial="{ opacity: 0, y: 20 }"
                    :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                    :delay="0"
                    :once="true"
                    :threshold="0.1"
                    class="flex flex-col md:flex-row justify-between items-center gap-10 border-b-2 border-black">
                    <div class="flex flex-row gap-6 lg:gap-20 md:gap-10 w-full justify-start md:w-auto">
                        <div class="font-extrabold text-lg md:text-3xl whitespace-nowrap leading-9">ë¬¸ì˜</div>
                        <div class="text-[1.4rem] leading-9">
                            <div class="font-extralight">FOURBERRY</div>
                            <div class="font-black">ì„±ê³µì ì¸ íŒŒíŠ¸ë„ˆê°€</div>
                            <div class="font-extralight">ê¸°ë‹¤ë¦¬ê³  ìˆìŠµë‹ˆë‹¤.</div>
                            <div class="font-black">ì§€ê¸ˆ ë°”ë¡œ ë¬¸ì˜í•˜ì„¸ìš”.</div>
                        </div>
                    </div>
                    <div>
                        <div class="flex flex-col md:flex-row justify-between items-center gap-10">
                            <div>
                                <img 
                                src="/images/contact/bg_contact.png" 
                                class="w-full max-w-sm" 
                                />
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ìƒë‹´ ëª©ë¡ -->
                <div class="flex flex-col gap-6">
                    <SectionTitle>ìƒë‹´ë¬¸ì˜</SectionTitle>
                    <!-- ë¬¸ì˜ í¼ -->
                    <form @submit.prevent="handleSubmit">
                        <ol class="flex flex-col gap-10">
                            <!-- ìƒë‹´ ìœ í˜• -->
                            <li
                                v-motion
                                :initial="{ opacity: 0, y: 20 }"
                                :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                                :delay="150"
                                :once="true"
                                :threshold="0.1"
                            >
                                <h4 class="font-extrabold mb-1">ì–´ë–¤ ìœ í˜•ì˜ ìƒë‹´ì„ ì›í•˜ì‹œë‚˜ìš”?</h4>
                                <div class="text-xs font-medium mb-3">í•„ìˆ˜ ì„ íƒ ğŸ“Œ</div>
                                <ul class="grid grid-cols-[repeat(auto-fit,_minmax(130px,_1fr))] gap-3 list-none m-0 p-0">
                                    <li v-for="type in consultationTypes" :key="type.id">
                                        <input type="radio" name="rdoType" :id="type.id" :value="type.value" class="hidden peer" v-model="selectedType" />
                                        <label 
                                            :for="type.id"
                                            class="flex w-full cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-white py-3 px-2 text-center text-sm font-medium text-gray-700
                                                    hover:bg-gray-50
                                                    peer-checked:border-primary
                                                    peer-checked:bg-primary
                                                    peer-checked:font-bold 
                                                    peer-checked:text-white
                                                    truncate">
                                            {{ type.label }}
                                        </label>
                                    </li>
                                </ul>
                            </li>
                            <!-- ê´€ì‹¬ ì„œë¹„ìŠ¤ -->
                            <li
                                v-motion
                                :initial="{ opacity: 0, y: 20 }"
                                :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                                :delay="200"
                                :once="true"
                                :threshold="0.1"
                            >
                                <h4 class="font-extrabold mb-1">ê´€ì‹¬ ì„œë¹„ìŠ¤ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.</h4>
                                <div class="text-xs font-medium mb-3">ë‹¤ì¤‘ ì„ íƒ ğŸ“š</div>
                                <ul class="grid grid-cols-[repeat(auto-fit,_minmax(130px,_1fr))] gap-3 list-none m-0 p-0">
                                    <li v-for="service in favoriteServices" :key="service.id">
                                        <input type="checkbox" :id="service.id" :value="service.value" class="hidden peer" v-model="selectedServices" />
                                        <label 
                                            :for="service.id"
                                            class="flex w-full cursor-pointer items-center justify-center rounded-md border border-gray-300 bg-white py-3 px-2 text-center text-sm font-medium text-gray-700
                                                    hover:bg-gray-50
                                                    peer-checked:border-primary
                                                    peer-checked:bg-primary
                                                    peer-checked:font-bold 
                                                    peer-checked:text-white
                                                    truncate">
                                            {{ service.label }}
                                        </label>
                                    </li>
                                </ul>
                            </li>
                            <!-- ì˜ˆì‚°/ì¼ì • -->
                            <li
                                v-motion
                                :initial="{ opacity: 0, y: 20 }"
                                :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                                :delay="250"
                                :once="true"
                                :threshold="0.1"
                            >
                                <h4 class="font-extrabold mb-3">ì˜ˆì‚°ê³¼ ì¼ì •ì€ ì–´ë–»ê²Œ ë˜ë‚˜ìš”?</h4>
                                <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 list-none m-0 p-0">
                                    <li>
                                        <FormSelect
                                            id="budget_select"
                                            placeholder="ì˜ˆì‚°ì„ ì„ íƒí•˜ì„¸ìš”."
                                            :options="budgetOptions"
                                            v-model="selectedBudget"
                                        />
                                    </li>
                                    <li>
                                        <FormSelect
                                            id="schedule_select"
                                            placeholder="ì¼ì •ì„ ì„ íƒí•˜ì„¸ìš”."
                                            :options="scheduleOptions"
                                            v-model="selectedSchedule"
                                        />
                                    </li>
                                </ul>
                            </li>
                            <!-- ê¸°íƒ€ë‚´ìš©(íŒŒì¼ ì—…ë¡œë“œ) -->
                            <li
                                v-motion
                                :initial="{ opacity: 0, y: 20 }"
                                :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                                :delay="300"
                                :once="true"
                                :threshold="0.1"
                            >
                                <h4 class="font-extrabold mb-1">ì¶”ê°€ë¡œ ì „ë‹¬í•˜ê³  ì‹¶ì€ ë‚´ìš©ì´ ìˆìœ¼ì‹ ê°€ìš”?</h4>
                                <div class="text-xs font-medium mb-3">êµ¬ì²´ì ì¸ ë‚´ìš©ì„ ì ì–´ì£¼ì‹œë©´ ì´í•´í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.</div>
                                <textarea 
                                    rows="5"
                                    class="block p-4 w-full text-sm text-gray-900 bg-white rounded-lg border border-gray-300 focus:ring-primary focus:border-primary 
                                        dark:bg-gray-50 dark:border-gray-600 dark:placeholder-gray-400 dark:text-gray-900 dark:focus:ring-primary dark:focus:border-primary"
                                    placeholder="ì˜ˆ: í”„ë¡œì íŠ¸ ê°œìš”, ìš”êµ¬ì‚¬í•­ ë“±"
                                    v-model="textareaContent"
                                    maxlength="4000">
                                </textarea>
                                <div class="text-right text-xs text-gray-500 mt-2 mb-3">
                                    {{ textareaContent.length }}/4000ì
                                </div>
                                
                                <FormFileUpload
                                    id="contact_file_upload"
                                    label="íŒŒì¼ ì²¨ë¶€ (ì„ íƒ)"
                                    :maxFiles="5"
                                    :maxSizeMb="10"
                                    v-model="selectedFiles"
                                />
                            </li>

                            <!-- ì˜ë¢°ì¸ ì •ë³´ -->
                            <li
                                v-motion
                                :initial="{ opacity: 0, y: 20 }"
                                :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                                :delay="350"
                                :once="true"
                                :threshold="0.1"
                            >
                                <h4 class="font-extrabold mb-3">ì˜ë¢°í•˜ì‹œëŠ” ë¶„ì˜ ì •ë³´ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.</h4>

                                <ul class="grid grid-cols-1 md:grid-cols-2 gap-3 list-none m-0 p-0">
                                    <li>
                                        <FormFloatingInput
                                            id="client_company"
                                            label="íšŒì‚¬/ë‹¨ì²´ëª…"
                                            v-model="clientInfo.company"
                                            :maxlength="50"
                                            :required="true"
                                        />
                                    </li>
                                    <li>
                                        <FormFloatingInput
                                            id="client_name"
                                            label="ë‹´ë‹¹ìëª…"
                                            v-model="clientInfo.name"
                                            :maxlength="30"
                                            :required="true"
                                        />
                                    </li>
                                    <li>
                                        <FormFloatingInput
                                            id="client_tel"
                                            label="ì—°ë½ì²˜"
                                            type="tel"
                                            v-model="clientInfo.tel"
                                            :maxlength="11"
                                            :required="true"
                                        />
                                    </li>
                                    <li>
                                        <FormFloatingInput
                                            id="client_email"
                                            label="ì´ë©”ì¼"
                                            type="email"
                                            v-model="clientInfo.email"
                                            :maxlength="100"
                                            :required="true"
                                        />
                                    </li>
                                </ul>
                            </li>

                            <!-- ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ -->
                            <li
                                v-motion
                                :initial="{ opacity: 0, y: 20 }"
                                :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                                :delay="400"
                                :once="true"
                                :threshold="0.1"
                            >
                                <div class="flex items-center">
                                    <input id="link-checkbox" type="checkbox" v-model="isPrivacyAgreed" class="w-4 h-4 text-primary bg-gray-100 border-gray-300 rounded-sm focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600">
                                    <label for="link-checkbox" class="ms-2 text-sm font-medium text-gray-900 dark:text-gray-300"><a href="#" class="text-primary dark:text-blue-500 hover:underline">ê°œì¸ì •ë³´ë³´í˜¸ì •ì±…</a>ì— ë™ì˜í•©ë‹ˆë‹¤.<em class="text-red-600 font-bold">*</em></label>
                                </div>
                            </li>
                            <!-- ì œì¶œ ë²„íŠ¼ -->
                            <li
                                v-motion
                                :initial="{ opacity: 0, y: 20 }"
                                :visible="{ opacity: 1, y: 0, transition: { duration: 500 } }"
                                :delay="450"
                                :once="true"
                                :threshold="0.1"
                            >
                                <BaseButton type="submit" :loading="isLoading">
                                    ë¬¸ì˜í•˜ê¸°
                                </BaseButton>
                            </li>
                        </ol>
                    </form>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup lang="ts">
import SectionTitle from '@/components/contact/SectionTitle.vue';
import FormFloatingInput from '@/components/contact/FormFloatingInput.vue';
import FormSelect from '@/components/contact/FormSelect.vue';
import FormFileUpload from '@/components/contact/FormFileUpload.vue';
import BaseButton from '@/components/contact/BaseButton.vue';

// ì†”ë£¨ì…˜ ë„ì… ë¬¸ì˜
// ì‹ ê·œ ì‹œìŠ¤í…œ êµ¬ì¶• ì˜ë¢°
// ìœ ì§€ë³´ìˆ˜ ë° ê¸°ìˆ ì§€ì›
// ì‚¬ì—… ì œíœ´ ë° íŒŒíŠ¸ë„ˆì‹­
// ê¸°íƒ€ ì¼ë°˜ ë¬¸ì˜
const consultationTypes = [
    { id: 'TYPE_01', value: 'TYPE_01', label: 'ì‹ ê·œ ì‹œìŠ¤í…œ êµ¬ì¶•' },
    { id: 'TYPE_02', value: 'TYPE_02', label: 'ì‹œìŠ¤í…œ ìœ ì§€ë³´ìˆ˜' },
    { id: 'TYPE_03', value: 'TYPE_03', label: 'ì†”ë£¨ì…˜ ë„ì…' },
    { id: 'TYPE_04', value: 'TYPE_04', label: 'AI ë„ì…' },
    { id: 'TYPE_05', value: 'TYPE_05', label: 'í™ˆí˜ì´ì§€ êµ¬ì¶•' },
    { id: 'TYPE_06', value: 'TYPE_06', label: 'ê¸°íƒ€ ì¼ë°˜ ë¬¸ì˜' }
];

const favoriteServices = [
    { id: 'SERVICE_01', value: 'SERVICE_01', label: 'í†µí•© ì¸ì¦ (SSO)' },
    { id: 'SERVICE_02', value: 'SERVICE_02', label: 'ë°ì´í„° ìŠ¤í¬ë˜í¼' },
    { id: 'SERVICE_03', value: 'SERVICE_03', label: 'í†µí•© ë©”ì‹œì§• (UMS)' },
    { id: 'SERVICE_04', value: 'SERVICE_04', label: 'ì‡¼í•‘ëª° êµ¬ì¶•Â·ìš´ì˜' },
    { id: 'SERVICE_05', value: 'SERVICE_05', label: 'ì£¼ë¬¸ ê´€ë¦¬ (OMS)' },
    { id: 'SERVICE_06', value: 'SERVICE_06', label: 'ê¸°íƒ€ ì‹œìŠ¤í…œ ê°œë°œ' }
];

const budgetOptions = [
    { value: '1000', label: '1000ë§Œì› ë¯¸ë§Œ' },
    { value: '5000', label: '5000ë§Œì› ë¯¸ë§Œ' },
    { value: '10000', label: '1ì–µì› ë¯¸ë§Œ' },
    { value: '30000', label: '3ì–µì› ë¯¸ë§Œ' },
    { value: '50000', label: '5ì–µì› ë¯¸ë§Œ' },
    { value: '70000', label: '7ì–µì› ë¯¸ë§Œ' },
    { value: '0', label: 'ë¯¸ì •' },
];

const scheduleOptions = [
    { value: 'one_month', label: '1ê°œì›” ì´ë‚´' },
    { value: 'three_months', label: '3ê°œì›” ì´ë‚´' },
    { value: 'six_months', label: '6ê°œì›” ì´ë‚´' },
    { value: 'one_year', label: '1ë…„ ì´ë‚´' },
    { value: 'more_than_one_year', label: '1ë…„ ì´ìƒ' },
    { value: 'undecided', label: 'ë¯¸ì •' },
];

const selectedType = ref(''); // ìƒë‹´ ìœ í˜•
const selectedServices = ref<string[]>([]); // ê´€ì‹¬ ì„œë¹„ìŠ¤
const selectedBudget = ref('');
const selectedSchedule = ref('');
const textareaContent = ref<string>(''); // ì¶”ê°€ ë‚´ìš©
const selectedFiles = ref<File[]>([]);
const isLoading = ref(false);
const isPrivacyAgreed = ref(false);

// ì˜ë¢°ì ì •ë³´
const clientInfo = ref({
    company: '',
    name: '',
    tel: '',
    email: '',
});

/**
 * í¼ ìœ íš¨ì„± ê²€ì‚¬ í•¨ìˆ˜
 */
const validateForm = (): boolean => {
    // 1. ìƒë‹´ ìœ í˜• (í•„ìˆ˜)
    if (!selectedType.value) {
        alert('ì–´ë–¤ ìœ í˜•ì˜ ìƒë‹´ì„ ì›í•˜ì‹œë‚˜ìš”? (í•„ìˆ˜)');
        return false;
    }

    // 2. ì˜ë¢°ì¸ ì •ë³´ (í•„ìˆ˜)
    // (FormFloatingInputì´ ìì²´ ìœ íš¨ì„± ê²€ì‚¬ë¥¼ í•˜ì§€ë§Œ, ìµœì¢… ì œì¶œ ì‹œ í•œ ë²ˆ ë” í™•ì¸)
    const telRegex = /^\d{10,11}$/;
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;

    if (!clientInfo.value.name.trim()) {
        alert('ë‹´ë‹¹ìëª…ì€ í•„ìˆ˜ì…ë‹ˆë‹¤.');
        return false;
    }
    if (!clientInfo.value.tel.trim() || !telRegex.test(clientInfo.value.tel)) {
        alert('ìœ íš¨í•œ ì—°ë½ì²˜ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”. (10~11ìë¦¬ ìˆ«ì)');
        return false;
    }
    if (!clientInfo.value.email.trim() || !emailRegex.test(clientInfo.value.email)) {
        alert('ìœ íš¨í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
        return false;
    }

    // 3. ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨ (í•„ìˆ˜)
    if (!isPrivacyAgreed.value) {
        alert('ê°œì¸ì •ë³´ë³´í˜¸ì •ì±…ì— ë™ì˜í•´ì£¼ì„¸ìš”.');
        return false;
    }

    return true;
};

/**
 * í¼ ì´ˆê¸°í™” í•¨ìˆ˜
 */
const resetForm = () => {
    selectedType.value = '';
    selectedServices.value = [];
    textareaContent.value = '';
    clientInfo.value = { company: '', name: '', tel: '', email: '' };
    selectedBudget.value = '';
    selectedSchedule.value = '';
    selectedFiles.value = [];
    isPrivacyAgreed.value = false;
};

/**
 * API ì œì¶œ í•¸ë“¤ëŸ¬
 */
const handleSubmit = async () => {
    if (isLoading.value) return; // ì¤‘ë³µ ì œì¶œ ë°©ì§€

    // 1. ìœ íš¨ì„± ê²€ì‚¬
    if (!validateForm()) {
        return; // ìœ íš¨ì„± ê²€ì‚¬ ì‹¤íŒ¨ ì‹œ ì¤‘ë‹¨
    }

    isLoading.value = true;

    // 2. FormData ìƒì„±
    const formData = new FormData();

    // 2-1. í¼ ë°ì´í„° (JSONì´ ì•„ë‹Œ ê°œë³„ í•„ë“œë¡œ ì¶”ê°€)
    formData.append('type', selectedType.value);
    formData.append('services', JSON.stringify(selectedServices.value)); // ë°°ì—´ì€ JSON ë¬¸ìì—´ë¡œ
    formData.append('budget', selectedBudget.value);
    formData.append('schedule', selectedSchedule.value);
    formData.append('content', textareaContent.value);
    formData.append('company', clientInfo.value.company);
    formData.append('name', clientInfo.value.name);
    formData.append('tel', clientInfo.value.tel);
    formData.append('email', clientInfo.value.email);

    // 2-2. íŒŒì¼ ë°ì´í„° (ë‹¤ì¤‘ íŒŒì¼)
    selectedFiles.value.forEach((file, index) => {
        formData.append('files', file); // 'files'ë¼ëŠ” ë™ì¼í•œ keyë¡œ ì—¬ëŸ¬ íŒŒì¼ì„ ì¶”ê°€
    });

    try {
        // 3. API í˜¸ì¶œ (Nuxt 3ì˜ $fetch ì‚¬ìš©)
        //    - /api/contactëŠ” ì˜ˆì‹œ ì—”ë“œí¬ì¸íŠ¸ì…ë‹ˆë‹¤.
        //    - ì‹¤ì œ Spring Boot/Node.js ì„œë²„ì˜ ì—”ë“œí¬ì¸íŠ¸ë¡œ ë³€ê²½í•´ì•¼ í•©ë‹ˆë‹¤.
        await $fetch('/api/contact', {
            method: 'POST',
            body: formData,
            // (ì°¸ê³ ) bodyê°€ FormDataì¼ ê²½ìš° 'Content-Type': 'multipart/form-data'
            // í—¤ë”ëŠ” ë¸Œë¼ìš°ì €ê°€ ìë™ìœ¼ë¡œ ì„¤ì •í•˜ë¯€ë¡œ ëª…ì‹œí•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
        });

        // 4. ì„±ê³µ ì²˜ë¦¬
        alert('ë¬¸ì˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤. ê°ì‚¬í•©ë‹ˆë‹¤.');
        resetForm(); // í¼ ì´ˆê¸°í™”

    } catch (error) {
        // 5. ì‹¤íŒ¨ ì²˜ë¦¬
        console.error('ë¬¸ì˜ ì „ì†¡ ì‹¤íŒ¨:', error);
        alert('ë¬¸ì˜ ì „ì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } finally {
        // 6. ë¡œë”© ìƒíƒœ í•´ì œ
        isLoading.value = false;
    }
};
</script>

<style lang="scss" scoped></style>