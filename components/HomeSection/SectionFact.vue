<template>
  <section class="bg-background">
    <div class="container mx-auto px-4 py-16 md:py-24">
      <h2 class="sr-only">회사 기본 정보</h2>

      <!-- 섹션 타이틀 -->
      <h3 class="text-black text-2xl md:text-3xl font-bold mb-8 tracking-tight">
        LOCATION
      </h3>

      <!-- 2컬럼 레이아웃 -->
      <div
        class="grid grid-cols-1 lg:grid-cols-2 gap-10 lg:gap-16 items-stretch"
      >
        <!-- ========== 왼쪽: 지도 영역 ========== -->
        <!-- ✅ shadow-md 제거 -->
        <div class="flex flex-col rounded-2xl h-full space-y-4 min-h-full">
          <!-- 지도 상단 컨트롤 -->
          <div class="flex flex-wrap items-center gap-3 text-black text-sm">
            <button
              class="px-3 py-2 rounded-lg border border-gray-400 bg-gray-100 hover:bg-gray-200 transition text-black"
              @click="toggleTraffic"
            >
              교통정보 {{ trafficOn ? "끄기" : "켜기" }}
            </button>
          </div>

          <!-- 지도 컨테이너 -->
          <div class="relative w-full">
            <!-- ✅ 테두리 없음, 내부 그림자만 유지 -->
            <div
              ref="mapContainerRef"
              class="w-full h-[400px] shadow-inner bg-gray-100"
            ></div>

            <!-- 주소 라벨 -->
            <div
              class="absolute bottom-4 left-4 bg-white/90 text-gray-800 text-xs px-3 py-2 rounded-lg shadow-lg border border-gray-300"
            >
              서울특별시 영등포구 양평로 22길 21<br />
              코오롱디지털타워 1409호 (선유도 인근)
            </div>
          </div>
        </div>

        <!-- ========== 오른쪽: 회사 정보 영역 ========== -->
        <div class="flex flex-col justify-center h-full min-h-full">
          <dl class="divide-y-2 divide-gray-300">
            <!-- 회사명 -->
            <div class="grid grid-cols-1 md:grid-cols-6 gap-3 py-5 md:py-6">
              <dt
                class="md:col-span-2 text-sm md:text-base lg:text-lg text-gray-600"
              >
                회사명
              </dt>
              <dd
                class="md:col-span-4 text-base md:text-lg lg:text-xl text-black md:pl-6 lg:pl-8"
              >
                포베리주식회사
              </dd>
            </div>

            <!-- 설립일 -->
            <div class="grid grid-cols-1 md:grid-cols-6 gap-3 py-5 md:py-6">
              <dt
                class="md:col-span-2 text-sm md:text-base lg:text-lg text-gray-600"
              >
                설립일
              </dt>
              <dd
                class="md:col-span-4 text-base md:text-lg lg:text-xl text-black md:pl-6 lg:pl-8"
              >
                2023년 10월 30일
              </dd>
            </div>

            <!-- Contact -->
            <div class="grid grid-cols-1 md:grid-cols-6 gap-3 py-5 md:py-6">
              <dt
                class="md:col-span-2 text-sm md:text-base lg:text-lg text-gray-600"
              >
                Contact
              </dt>
              <dd
                class="md:col-span-4 text-base md:text-lg lg:text-xl text-black md:pl-6 lg:pl-8"
              >
                <div
                  class="grid grid-cols-[6rem_1fr] md:grid-cols-[7rem_1fr] gap-x-4 gap-y-2"
                >
                  <span class="text-gray-500 text-sm md:text-base">HP</span>
                  <span>010-2755-6550</span>

                  <span class="text-gray-500 text-sm md:text-base">Addr</span>
                  <span class="leading-relaxed break-keep">
                    서울특별시 영등포구 양평로 22길 21 코오롱디지털타워 1409호
                  </span>

                  <span class="text-gray-500 text-sm md:text-base">Email</span>
                  <span>damon@fourberry.co.kr</span>
                </div>
              </dd>
            </div>
          </dl>
        </div>
      </div>
    </div>
  </section>
</template>

<script setup lang="ts">
import { ref, onMounted } from "vue";

const mapContainerRef = ref<HTMLDivElement | null>(null);
const { $kakao } = useNuxtApp();

const trafficOn = ref(false);
let kakaoRef: any = null;
let mapRef: any = null;

const companyLat = 37.5398071417051;
const companyLng = 126.894657064548;

const toggleTraffic = () => {
  if (!mapRef || !kakaoRef) return;
  if (trafficOn.value) {
    mapRef.removeOverlayMapTypeId(kakaoRef.maps.MapTypeId.TRAFFIC);
    trafficOn.value = false;
  } else {
    mapRef.addOverlayMapTypeId(kakaoRef.maps.MapTypeId.TRAFFIC);
    trafficOn.value = true;
  }
};

onMounted(async () => {
  kakaoRef = await $kakao.load();
  const center = new kakaoRef.maps.LatLng(companyLat, companyLng);
  const mapOptions = { center, level: 4 };

  if (mapContainerRef.value) {
    mapRef = new kakaoRef.maps.Map(mapContainerRef.value, mapOptions);

    const marker = new kakaoRef.maps.Marker({ position: center, map: mapRef });

    const content = document.createElement("div");
    content.innerHTML = `
  <div style="
    display: inline-block;
    background: rgba(0, 0, 0, 0.85);
    border: 1px solid rgba(0, 0, 0, 0.25);
    border-radius: 10px;
    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.25);
    padding: 8px 14px;
    font-size: 13px;
    color: #fff;
    font-weight: 600;
    white-space: nowrap;
    transform: translate(-50%, -100%);
    position: absolute;
    left: 50%;
    bottom: 100%;
  ">
    포베리 주식회사
  </div>
`;

    const overlay = new kakaoRef.maps.CustomOverlay({
      content,
      position: center,
      yAnchor: 1.5,
    });

    overlay.setMap(mapRef);
  }
});
</script>
